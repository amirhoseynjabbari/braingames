<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¦ Flappy Bird | BrainGames</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazir', 'Tahoma', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .container {
            background: white;
            border-radius: 25px;
            padding: 20px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .back-btn {
            background: #764ba2;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            min-width: 80px;
            -webkit-tap-highlight-color: transparent;
        }

        .back-btn:hover {
            background: #5a3780;
            transform: translateY(-2px);
        }

        .back-btn:active {
            transform: scale(0.95);
        }

        h2 {
            color: #333;
            font-size: 1.4rem;
        }

        .game-area {
            position: relative;
            width: 100%;
            background: #4ec0ca;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            touch-action: none; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø²ÛŒ */
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            background: linear-gradient(180deg, #4ec0ca 0%, #56b4c4 100%);
            cursor: pointer;
            touch-action: none;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 15px 0;
            padding: 12px;
            background: #f0f0f0;
            border-radius: 15px;
            text-align: center;
        }

        .stat-item {
            font-size: 0.9rem;
            color: #333;
        }

        .stat-item span {
            display: block;
            background: #764ba2;
            color: white;
            padding: 6px 5px;
            border-radius: 20px;
            margin-top: 4px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .instructions {
            text-align: center;
            color: #666;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 50px;
            animation: pulse 1.5s infinite;
            font-size: 0.9rem;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            border-radius: 15px;
            padding: 15px;
        }

        .game-over.show {
            opacity: 1;
            pointer-events: all;
        }

        .game-over h3 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255,107,107,0.5);
        }

        .game-over-stats {
            width: 100%;
            margin: 15px 0;
        }

        .game-over-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 40px;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .game-over-item span:last-child {
            background: #27ae60;
            padding: 4px 15px;
            border-radius: 25px;
            font-weight: bold;
        }

        .restart-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.2);
            width: 80%;
            max-width: 250px;
            -webkit-tap-highlight-color: transparent;
        }

        .restart-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }

            h2 {
                font-size: 1.2rem;
            }

            .back-btn {
                padding: 6px 15px;
                font-size: 0.9rem;
                min-width: 70px;
            }

            .stats-panel {
                gap: 5px;
                padding: 8px;
            }

            .stat-item {
                font-size: 0.8rem;
            }

            .stat-item span {
                font-size: 1rem;
                padding: 4px;
            }

            .game-over h3 {
                font-size: 1.8rem;
            }

            .game-over-item {
                font-size: 0.9rem;
                padding: 8px 12px;
            }

            .restart-btn {
                padding: 10px 25px;
                font-size: 1rem;
            }
        }

        /* Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú© */
        @media (max-width: 360px) {
            .stats-panel {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .stat-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 5px 10px;
            }

            .stat-item span {
                display: inline-block;
                margin-top: 0;
                min-width: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" onclick="goBack()">ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2>ğŸ¦ Flappy Bird</h2>
        </div>

        <div class="game-area">
            <canvas id="gameCanvas" width="400" height="600"></canvas>
            <div class="game-over" id="gameOver">
                <h3>ğŸ’” Game Over</h3>
                <div class="game-over-stats">
                    <div class="game-over-item">
                        <span>ğŸ† Ø§Ù…ØªÛŒØ§Ø²</span>
                        <span id="finalScore">0</span>
                    </div>
                    <div class="game-over-item">
                        <span>â±ï¸ Ø²Ù…Ø§Ù†</span>
                        <span id="finalTime">0:00</span>
                    </div>
                    <div class="game-over-item">
                        <span>âš¡ Ø³Ø±Ø¹Øª</span>
                        <span id="finalSpeed">2.0x</span>
                    </div>
                </div>
                <button class="restart-btn" onclick="restartGame()">ğŸ”„ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
            </div>
        </div>

        <div class="stats-panel">
            <div class="stat-item">
                ğŸ† Ø§Ù…ØªÛŒØ§Ø²
                <span id="score">0</span>
            </div>
            <div class="stat-item">
                ğŸ‘‘ Ø±Ú©ÙˆØ±Ø¯
                <span id="highScore">0</span>
            </div>
            <div class="stat-item">
                â±ï¸ Ø²Ù…Ø§Ù†
                <span id="timer">0:00</span>
            </div>
        </div>

        <div class="instructions">
            ğŸ‘† Ù‡Ø± Ø¬Ø§ÛŒ ØµÙØ­Ù‡ Ø¨Ø²Ù†ÛŒ Ù…ÛŒâ€ŒÙ¾Ø±Ù‡
        </div>
    </div>

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø§Ù†ÙˆØ§Ø³
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ DOM
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const timerElement = document.getElementById('timer');
        const finalScoreElement = document.getElementById('finalScore');
        const finalTimeElement = document.getElementById('finalTime');
        const finalSpeedElement = document.getElementById('finalSpeed');
        const gameOverlay = document.getElementById('gameOver');

        // Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§Ù†ÙˆØ§Ø³
        canvas.width = 400;
        canvas.height = 600;

        // ØªØµÙˆÛŒØ± Ù¾Ø±Ù†Ø¯Ù‡
        const birdImage = new Image();
        birdImage.src = 'flappy.png';

        // Ø«Ø§Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        const GRAVITY = 0.2;
        const JUMP = -4.5;
        const PIPE_WIDTH = 60;
        const PIPE_GAP = 200;
        const BASE_SPEED = 2;
        const SPEED_INCREASE = 0.2;
        const SPEED_INTERVAL = 18;

        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        let gameRunning = false;
        let score = 0;
        let highScore = localStorage.getItem('flappyHighScore') || 0;
        let gameTime = 0;
        let timerInterval;
        let currentSpeed = BASE_SPEED;
        highScoreElement.textContent = highScore;

        // Ù¾Ø±Ù†Ø¯Ù‡
        let bird = {
            x: 100,
            y: 250,
            width: 60,
            height: 33,
            velocity: 0
        };

        // Ù„ÙˆÙ„Ù‡â€ŒÙ‡Ø§
        let pipes = [];
        let frameCount = 0;

        // ØªØ§ÛŒÙ…Ø±
        function startTimer() {
            gameTime = 0;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                gameTime++;
                updateTimerDisplay();
                
                if (gameTime % SPEED_INTERVAL === 0) {
                    currentSpeed = BASE_SPEED + (gameTime / SPEED_INTERVAL) * SPEED_INCREASE;
                    if (currentSpeed > 5) currentSpeed = 5;
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            let minutes = Math.floor(gameTime / 60);
            let seconds = gameTime % 60;
            timerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        }

        function createPipe() {
            let minHeight = 100;
            let maxHeight = canvas.height - PIPE_GAP - 100;
            let height = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;
            
            pipes.push({
                x: canvas.width,
                top: height,
                bottom: height + PIPE_GAP,
                passed: false
            });
        }

        function restartGame() {
            bird.y = 250;
            bird.velocity = 0;
            pipes = [];
            score = 0;
            frameCount = 0;
            gameTime = 0;
            currentSpeed = BASE_SPEED;
            gameRunning = true;
            gameOverlay.classList.remove('show');
            scoreElement.textContent = score;
            updateTimerDisplay();
            
            stopTimer();
            startTimer();
        }

        function update() {
            if (!gameRunning) return;

            bird.velocity += GRAVITY;
            bird.y += bird.velocity;

            if (bird.y <= 0) {
                bird.y = 0;
                gameOver();
            }
            if (bird.y + bird.height >= canvas.height) {
                bird.y = canvas.height - bird.height;
                gameOver();
            }

            frameCount++;
            if (frameCount % 90 === 0) {
                createPipe();
            }

            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= currentSpeed;

                if (bird.x + bird.width > pipes[i].x && 
                    bird.x < pipes[i].x + PIPE_WIDTH &&
                    (bird.y < pipes[i].top || bird.y + bird.height > pipes[i].bottom)) {
                    gameOver();
                }

                if (!pipes[i].passed && pipes[i].x + PIPE_WIDTH < bird.x) {
                    pipes[i].passed = true;
                    score++;
                    scoreElement.textContent = score;
                    
                    if (score > highScore) {
                        highScore = score;
                        localStorage.setItem('flappyHighScore', highScore);
                        highScoreElement.textContent = highScore;
                    }
                }

                if (pipes[i].x + PIPE_WIDTH < 0) {
                    pipes.splice(i, 1);
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Ø§Ø¨Ø±Ù‡Ø§ÛŒ Ù…ØªØ­Ø±Ú©
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.arc(100 + i * 150 + (frameCount % 200), 100 + i * 50, 40, 0, Math.PI * 2);
                ctx.fill();
            }

            // Ù„ÙˆÙ„Ù‡â€ŒÙ‡Ø§
            pipes.forEach(pipe => {
                ctx.fillStyle = '#27ae60';
                ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.top);
                ctx.fillRect(pipe.x, pipe.bottom, PIPE_WIDTH, canvas.height - pipe.bottom);
                
                ctx.fillStyle = '#229954';
                ctx.fillRect(pipe.x - 5, pipe.top - 30, PIPE_WIDTH + 10, 30);
                ctx.fillRect(pipe.x - 5, pipe.bottom, PIPE_WIDTH + 10, 30);
            });

            // Ù¾Ø±Ù†Ø¯Ù‡
            if (birdImage.complete) {
                ctx.drawImage(birdImage, bird.x, bird.y, bird.width, bird.height);
            } else {
                ctx.fillStyle = '#f1c40f';
                ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
            }

            // Ø³Ø±Ø¹Øª
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = 'bold 16px Vazir';
            ctx.textAlign = 'left';
            ctx.fillText(`âš¡ ${currentSpeed.toFixed(1)}x`, 10, 30);

            // Ù¾ÛŒØ§Ù… Ø´Ø±ÙˆØ¹
            if (!gameRunning && score === 0) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.font = 'bold 24px Vazir';
                ctx.textAlign = 'center';
                ctx.fillText('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ú©Ù„ÛŒÚ© Ú©Ù†', canvas.width/2, canvas.height/2);
            }

            requestAnimationFrame(draw);
        }

        function gameOver() {
            gameRunning = false;
            stopTimer();
            
            finalScoreElement.textContent = score;
            finalTimeElement.textContent = timerElement.textContent;
            finalSpeedElement.textContent = currentSpeed.toFixed(1) + 'x';
            gameOverlay.classList.add('show');
        }

        function jump() {
            if (!gameRunning) return;
            bird.velocity = JUMP;
        }

        function goBack() {
            stopTimer();
            window.location.href = '../index.html';
        }

        // ========== Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ùˆ Ø¯Ø³Ú©ØªØ§Ù¾ ==========
        
        // Ú©Ù„ÛŒÚ© Ù…ÙˆØ³
        canvas.addEventListener('click', (e) => {
            e.preventDefault();
            if (!gameRunning && score === 0) {
                gameRunning = true;
                startTimer();
            } else {
                jump();
            }
        });

        // Ù„Ù…Ø³ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„
            if (!gameRunning && score === 0) {
                gameRunning = true;
                startTimer();
            } else {
                jump();
            }
        });

        // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø§ Space
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!gameRunning && score === 0) {
                    gameRunning = true;
                    startTimer();
                } else {
                    jump();
                }
            }
        });

        // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø§ Ù„Ù…Ø³
        document.body.addEventListener('touchmove', (e) => {
            if (gameRunning) {
                e.preventDefault();
            }
        }, { passive: false });

        // Ø­Ù„Ù‚Ù‡ Ø¨Ø§Ø²ÛŒ
        function gameLoop() {
            update();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
        draw();
    </script>
</body>
</html>